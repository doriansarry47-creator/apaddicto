import { config } from 'dotenv';
import { getDB } from './server/db.js';
import { 
  educationalContents, 
  contentCategories, 
  contentTags 
} from './shared/schema.js';

config();

const db = getDB();

async function createEducationalContentFromPDF() {
  console.log('üöÄ Cr√©ation des cat√©gories de contenu...');
  
  try {
    // Cr√©er les cat√©gories de base
    const categories = [
      {
        name: "Activit√© Physique",
        description: "Contenus sur l'activit√© physique et le sport th√©rapeutique",
        color: "green",
        icon: "dumbbell",
        order: 1
      },
      {
        name: "Nutrition",
        description: "Conseils et ressources sur l'alimentation √©quilibr√©e",
        color: "orange",
        icon: "apple",
        order: 2
      },
      {
        name: "Gestion du Stress",
        description: "Techniques de relaxation et gestion du stress",
        color: "purple",
        icon: "brain",
        order: 3
      },
      {
        name: "Sommeil",
        description: "Am√©lioration de la qualit√© du sommeil",
        color: "blue",
        icon: "moon",
        order: 4
      },
      {
        name: "Psycho√©ducation",
        description: "Compr√©hension des m√©canismes addictifs",
        color: "indigo",
        icon: "book",
        order: 5
      },
      {
        name: "Addictologie",
        description: "Ressources sp√©cialis√©es sur les addictions",
        color: "red",
        icon: "alert-triangle",
        order: 6
      }
    ];

    const createdCategories = [];
    for (const categoryData of categories) {
      const [category] = await db.insert(contentCategories).values(categoryData).returning();
      createdCategories.push(category);
      console.log(`‚úÖ Cat√©gorie cr√©√©e: ${category.name}`);
    }

    // Cr√©er quelques tags de base
    const tags = [
      { name: "addiction", description: "Contenu li√© aux addictions", color: "red" },
      { name: "sport", description: "Activit√© physique et sport", color: "green" },
      { name: "sedentarite", description: "S√©dentarit√© et mode de vie", color: "orange" },
      { name: "therapie", description: "Approches th√©rapeutiques", color: "blue" },
      { name: "prevention", description: "Pr√©vention et sensibilisation", color: "purple" },
      { name: "recherche", description: "√âtudes et recherches scientifiques", color: "indigo" },
      { name: "motivation", description: "Motivation et changement comportemental", color: "yellow" },
      { name: "bien-etre", description: "Bien-√™tre g√©n√©ral", color: "teal" }
    ];

    const createdTags = [];
    for (const tagData of tags) {
      const [tag] = await db.insert(contentTags).values(tagData).returning();
      createdTags.push(tag);
      console.log(`‚úÖ Tag cr√©√©: ${tag.name}`);
    }

    console.log('üöÄ Cr√©ation du contenu √©ducatif bas√© sur le PDF Mildeca...');

    // Trouver la cat√©gorie "Activit√© Physique"
    const activityCategory = createdCategories.find(c => c.name === "Activit√© Physique");
    const addictionCategory = createdCategories.find(c => c.name === "Addictologie");
    
    // Contenu principal bas√© sur la revue de litt√©rature Mildeca
    const mainContent = {
      title: "Activit√©s Physiques et Sportives dans la Prise en Charge des Addictions",
      description: "Revue de litt√©rature compl√®te sur l'efficacit√© de l'activit√© physique dans le traitement des troubles addictifs, bas√©e sur les recherches de la Mission interminist√©rielle de lutte contre les drogues et les conduites addictives (Mildeca).",
      type: "text",
      categoryId: activityCategory?.id,
      tags: ["addiction", "sport", "therapie", "recherche", "prevention"],
      content: `# Activit√©s Physiques et Sportives dans la Prise en Charge des Addictions

## Introduction

Cette revue de litt√©rature, r√©alis√©e par l'Observatoire national de l'activit√© physique et de la s√©dentarit√© pour la Mission interminist√©rielle de lutte contre les drogues et les conduites addictives (Mildeca), explore le r√¥le crucial de l'activit√© physique dans la prise en charge des troubles addictifs.

## Contexte Scientifique

Les recherches r√©centes d√©montrent l'efficacit√© de l'activit√© physique comme outil th√©rapeutique compl√©mentaire dans le traitement des addictions. Cette approche s'inscrit dans une d√©marche globale de prise en charge qui prend en compte les aspects physiques, psychologiques et sociaux de la personne.

## M√©canismes d'Action

### 1. Effets Neurobiologiques

L'activit√© physique agit sur plusieurs neurotransmetteurs impliqu√©s dans les m√©canismes addictifs :

- **Dopamine** : L'exercice stimule la lib√©ration naturelle de dopamine, offrant une alternative saine au "reward system" perturb√© par les substances
- **Endorphines** : La production d'endorphines naturelles contribue √† la gestion du stress et de l'anxi√©t√©
- **GABA** : Am√©lioration de la r√©gulation √©motionnelle et r√©duction de l'impulsivit√©

### 2. B√©n√©fices Psychologiques

- Am√©lioration de l'estime de soi et de la confiance
- R√©duction des sympt√¥mes d√©pressifs et anxieux
- D√©veloppement de strat√©gies de coping positives
- Renforcement du sentiment d'efficacit√© personnelle

### 3. Aspects Sociaux

- Cr√©ation de nouveaux liens sociaux sains
- Int√©gration dans des groupes avec des objectifs positifs
- D√©veloppement d'une routine structurante
- Opportunit√©s de valorisation et de reconnaissance

## Recommandations Pratiques

### Types d'Activit√©s Recommand√©es

1. **Activit√©s a√©robies** (course, natation, cyclisme)
   - Fr√©quence : 3-5 fois par semaine
   - Dur√©e : 30-45 minutes
   - Intensit√© : mod√©r√©e √† vigoureuse

2. **Activit√©s de renforcement musculaire**
   - Fr√©quence : 2-3 fois par semaine
   - Focus : groupes musculaires majeurs
   - Progression graduelle

3. **Activit√©s de bien-√™tre** (yoga, tai-chi, m√©ditation en mouvement)
   - B√©n√©fices : gestion du stress, relaxation, mindfulness
   - Compl√©mentaires aux activit√©s plus intenses

### Adaptation Individuelle

La prescription d'activit√© physique doit √™tre personnalis√©e selon :
- Le type d'addiction
- L'√©tat de sant√© g√©n√©ral
- Les pr√©f√©rences personnelles
- Le niveau de condition physique initial
- Les comorbidit√©s √©ventuelles

## Mise en ≈íuvre Th√©rapeutique

### Int√©gration dans le Parcours de Soins

1. **√âvaluation initiale** : bilan m√©dical, motivationnel et physique
2. **D√©finition d'objectifs** : r√©alistes et progressifs
3. **Accompagnement** : par des professionnels form√©s
4. **Suivi r√©gulier** : adaptation du programme selon les progr√®s
5. **Pr√©vention des rechutes** : maintien de l'engagement √† long terme

### Professionnels Impliqu√©s

- M√©decins addictologues
- √âducateurs en activit√© physique adapt√©e (EAPA)
- Psychologues du sport
- Kin√©sith√©rapeutes
- √âducateurs sp√©cialis√©s

## Preuves Scientifiques

Les √©tudes montrent des r√©sultats prometteurs :

- **R√©duction des rechutes** : jusqu'√† 30% de diminution dans certaines √©tudes
- **Am√©lioration de la qualit√© de vie** : scores significativement am√©lior√©s
- **R√©duction des sympt√¥mes de sevrage** : att√©nuation des effets physiques et psychologiques
- **Maintien de l'abstinence** : meilleure adh√©sion au traitement global

## D√©fis et Limites

### Obstacles √† Surmonter

- Manque de motivation initial
- Probl√®mes de sant√© physique
- Stigmatisation
- Manque d'accessibilit√© aux structures

### Solutions Propos√©es

- Approche progressive et bienveillante
- Adaptation des activit√©s aux capacit√©s
- Cr√©ation d'environnements non stigmatisants
- D√©veloppement de partenariats locaux

## Perspectives d'Avenir

L'activit√© physique s'impose comme un pilier essentiel de la prise en charge moderne des addictions. Les recherches futures devront pr√©ciser :

- Les protocoles optimaux selon les types d'addiction
- L'impact √† long terme sur la pr√©vention des rechutes
- L'int√©gration dans les parcours de soins coordonn√©s
- Le d√©veloppement d'outils d'√©valuation sp√©cifiques

## Conclusion

Cette revue de litt√©rature confirme l'int√©r√™t majeur de l'activit√© physique comme outil th√©rapeutique dans la prise en charge des addictions. Son int√©gration dans les programmes de soins repr√©sente une approche prometteuse pour am√©liorer les r√©sultats th√©rapeutiques et la qualit√© de vie des personnes concern√©es.

L'approche doit √™tre holistique, personnalis√©e et s'inscrire dans une d√©marche pluridisciplinaire pour maximiser ses b√©n√©fices.

---

*Bas√© sur la revue de litt√©rature Mildeca 2023 - "Activit√©s physiques et sportives, s√©dentarit√©, addictions"*`,
      difficulty: "intermediate",
      estimatedReadTime: 15,
      status: "published",
      isRecommended: true,
      publishedAt: new Date()
    };

    const [createdContent] = await db.insert(educationalContents).values(mainContent).returning();
    console.log(`‚úÖ Contenu principal cr√©√©: ${createdContent.title}`);

    // Cr√©er des contenus compl√©mentaires plus courts
    const additionalContents = [
      {
        title: "Les B√©n√©fices Neurobiologiques de l'Exercice Physical contre l'Addiction",
        description: "Comprendre comment l'activit√© physique agit sur le cerveau pour combattre les m√©canismes addictifs.",
        type: "text",
        categoryId: addictionCategory?.id,
        tags: ["addiction", "sport", "recherche"],
        content: `# Les B√©n√©fices Neurobiologiques de l'Exercice Physical

## Comment l'Exercice Rewire le Cerveau

L'activit√© physique provoque des changements profonds dans le cerveau qui peuvent aider √† surmonter l'addiction :

### Syst√®me de R√©compense
- Restauration de la sensibilit√© dopaminergique naturelle
- Cr√©ation de nouvelles voies de plaisir saines
- R√©duction de la tol√©rance aux substances

### Stress et Anxi√©t√©
- Diminution du cortisol (hormone du stress)
- Augmentation de la production de GABA
- Am√©lioration de la r√©gulation √©motionnelle

### Neuroplasticit√©
- Formation de nouvelles connexions neuronales
- Renforcement des circuits de contr√¥le ex√©cutif
- Am√©lioration de la capacit√© de prise de d√©cision

## Applications Pratiques

Ces m√©canismes expliquent pourquoi l'exercice est si efficace comme th√©rapie compl√©mentaire dans le traitement des addictions.`,
        difficulty: "advanced",
        estimatedReadTime: 8,
        status: "published",
        isRecommended: false
      },
      {
        title: "Programme d'Activit√© Physique pour D√©butants en R√©cup√©ration",
        description: "Un guide pratique pour commencer l'activit√© physique durant la phase de r√©cup√©ration d'une addiction.",
        type: "text",
        categoryId: activityCategory?.id,
        tags: ["sport", "therapie", "motivation"],
        content: `# Programme d'Activit√© Physique pour D√©butants

## Semaine 1-2 : D√©marrage en Douceur

### Objectifs
- R√©habituer le corps au mouvement
- Cr√©er une routine positive
- √âviter le surmenage et la frustration

### Activit√©s Recommand√©es
- **Marche** : 15-20 minutes par jour
- **√âtirements** : 10 minutes matin et soir
- **Respiration** : exercices de coh√©rence cardiaque

## Semaine 3-4 : Progression Graduelle

### Augmentation Progressive
- Marche : 25-30 minutes
- Ajout d'exercices de renforcement l√©ger
- Introduction d'activit√©s plaisantes (danse, jardinage)

## Conseils Essentiels

### √âcouter Son Corps
- Respecter les limites
- Adapter selon l'√©nergie du jour
- C√©l√©brer chaque petit progr√®s

### Cr√©er des Habitudes
- Choisir un moment fixe dans la journ√©e
- Commencer petit mais r√©guli√®rement
- Se r√©compenser (sainement) apr√®s chaque s√©ance

### Soutien Social
- Trouver un partenaire d'exercice
- Rejoindre un groupe adapt√©
- Partager ses progr√®s avec l'√©quipe soignante

## Signaux d'Alerte

Arr√™ter et consulter si :
- Douleurs persistantes
- Essoufflement excessif
- Vertiges ou malaises
- Perte de motivation totale

L'objectif est le bien-√™tre, pas la performance !`,
        difficulty: "easy",
        estimatedReadTime: 6,
        status: "published",
        isRecommended: true
      },
      {
        title: "S√©dentarit√© et Risques d'Addiction : Ce qu'il Faut Savoir",
        description: "Les liens entre mode de vie s√©dentaire et vuln√©rabilit√© aux addictions.",
        type: "text",
        categoryId: addictionCategory?.id,
        tags: ["sedentarite", "prevention", "addiction"],
        content: `# S√©dentarit√© et Risques d'Addiction

## Le Cercle Vicieux

La s√©dentarit√© et l'addiction peuvent se renforcer mutuellement :

### Comment la S√©dentarit√© Favorise l'Addiction
- Diminution de la production naturelle de dopamine
- Augmentation du stress et de l'ennui
- R√©duction de l'estime de soi
- Isolement social

### Comment l'Addiction Renforce la S√©dentarit√©
- Perte d'int√©r√™t pour les activit√©s physiques
- Fatigue chronique
- Probl√®mes de sant√©
- Cercle social moins actif

## Briser le Cycle

### √âtapes Cl√©s
1. **Prise de conscience** du lien s√©dentarit√©-addiction
2. **Petits changements** dans le quotidien
3. **Augmentation progressive** de l'activit√©
4. **Soutien professionnel** si n√©cessaire

### Actions Concr√®tes
- Se lever toutes les heures
- Prendre les escaliers
- Marcher pour les trajets courts
- Int√©grer l'activit√© dans les loisirs

## Pr√©vention

Pour les personnes √† risque :
- Maintenir un minimum d'activit√© quotidienne
- Diversifier les sources de plaisir
- Cultiver les liens sociaux actifs
- Surveiller les signaux d'alerte`,
        difficulty: "easy",
        estimatedReadTime: 5,
        status: "published",
        isRecommended: false
      }
    ];

    for (const contentData of additionalContents) {
      const [content] = await db.insert(educationalContents).values(contentData).returning();
      console.log(`‚úÖ Contenu additionnel cr√©√©: ${content.title}`);
    }

    console.log('üéâ Tous les contenus ont √©t√© cr√©√©s avec succ√®s !');
    console.log(`üìä R√©sum√© :`);
    console.log(`   - ${createdCategories.length} cat√©gories cr√©√©es`);
    console.log(`   - ${createdTags.length} tags cr√©√©s`);
    console.log(`   - ${additionalContents.length + 1} contenus √©ducatifs cr√©√©s`);

  } catch (error) {
    console.error('‚ùå Erreur lors de la cr√©ation du contenu:', error);
    throw error;
  }
}

// Ex√©cuter le script
createEducationalContentFromPDF()
  .then(() => {
    console.log('‚úÖ Script termin√© avec succ√®s');
    process.exit(0);
  })
  .catch((error) => {
    console.error('‚ùå Erreur fatale:', error);
    process.exit(1);
  });