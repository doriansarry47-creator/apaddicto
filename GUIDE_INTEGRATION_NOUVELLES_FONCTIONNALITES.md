# Guide d'Int√©gration des Nouvelles Fonctionnalit√©s

Ce guide d√©taille l'impl√©mentation compl√®te des nouvelles fonctionnalit√©s pour l'application de th√©rapie sportive.

## üéØ R√©sum√© des Fonctionnalit√©s Impl√©ment√©es

### ‚úÖ Fonctionnalit√©s Principales
1. **Publication & assignation des s√©ances** - Syst√®me complet d'assignation patient-s√©ance
2. **Gestion des statuts des s√©ances** - Draft/Published/Archived avec filtrage
3. **Cat√©gorisation & filtres** - Tags sur exercices et s√©ances avec filtres avanc√©s
4. **Suivi des s√©ances r√©alis√©es** - Feedback d√©taill√© avec effort et dur√©e
5. **Variables dynamiques** - 3 variables personnalisables par exercice
6. **M√©diath√®que** - Support m√©dia suppl√©mentaire pour les exercices

## üìÅ Nouveaux Fichiers Cr√©√©s

### Backend
- `shared/schema.ts` - ‚úÖ **Modifi√©** : Nouveaux mod√®les PatientSession, champs √©tendus
- `server/routes.ts` - ‚úÖ **Modifi√©** : Nouveaux endpoints API
- `server/storage.ts` - ‚úÖ **Modifi√©** : Nouvelles m√©thodes de base de donn√©es

### Frontend - Composants
- `client/src/components/patient-session-editor.tsx` - ‚úÖ **Nouveau** : Interface admin pour assigner s√©ances
- `client/src/components/exercise-form.tsx` - ‚úÖ **Nouveau** : Formulaire cr√©ation/√©dition exercices
- `client/src/components/admin-dashboard.tsx` - ‚úÖ **Nouveau** : Dashboard de suivi administrateur
- `client/src/components/patient-sessions.tsx` - ‚úÖ **Nouveau** : Interface patient pour s√©ances
- `client/src/components/enhanced-session-builder.tsx` - ‚úÖ **Modifi√©** : Ajout bouton "Publier"
- `client/src/components/exercise-card.tsx` - ‚úÖ **Modifi√©** : Support tags et variables

### Base de Donn√©es
- `migrations/add_session_features.sql` - ‚úÖ **Nouveau** : Script de migration

## üîß Installation et Configuration

### 1. Migration Base de Donn√©es

```bash
# Ex√©cuter le script de migration
psql -d votre_database -f migrations/add_session_features.sql
```

### 2. V√©rification des Nouveaux Types

Assurez-vous que les types TypeScript sont correctement import√©s dans vos pages :

```typescript
import type { 
  CustomSession, 
  PatientSession, 
  InsertPatientSession 
} from '../shared/schema';
```

### 3. Installation des Composants UI Manquants

Si n√©cessaire, installez les composants UI utilis√©s :

```bash
npm install @radix-ui/react-dialog @radix-ui/react-tooltip @radix-ui/react-slider
```

## üöÄ Utilisation des Nouveaux Composants

### 1. Interface Administrateur

#### Dashboard Admin
```typescript
import { AdminDashboard } from '@/components/admin-dashboard';

function AdminPage() {
  const [stats, setStats] = useState({});
  const [patients, setPatients] = useState([]);

  const fetchData = async () => {
    const statsResponse = await fetch('/api/admin/dashboard');
    const patientsResponse = await fetch('/api/admin/patients');
    setStats(await statsResponse.json());
    setPatients(await patientsResponse.json());
  };

  return (
    <AdminDashboard 
      stats={stats} 
      patients={patients} 
      onRefresh={fetchData} 
    />
  );
}
```

#### Assignation de S√©ances
```typescript
import { PatientSessionEditor } from '@/components/patient-session-editor';

function SessionAssignmentPage() {
  const handleAssignSession = async (sessionId: string, patientIds: string[]) => {
    await fetch(`/api/sessions/${sessionId}/publish`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ patientIds })
    });
  };

  return (
    <PatientSessionEditor
      patients={patients}
      sessions={sessions}
      onAssignSession={handleAssignSession}
      onRefresh={fetchData}
    />
  );
}
```

#### Cr√©ateur d'Exercices
```typescript
import { ExerciseForm } from '@/components/exercise-form';

function ExerciseCreationPage() {
  const handleSaveExercise = async (exerciseData) => {
    const response = await fetch('/api/exercises', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(exerciseData)
    });
    return response.json();
  };

  return (
    <ExerciseForm
      onSave={handleSaveExercise}
      onCancel={() => navigate('/admin/exercises')}
    />
  );
}
```

#### Session Builder avec Publication
```typescript
import { EnhancedSessionBuilder } from '@/components/enhanced-session-builder';

function SessionBuilderPage() {
  const handlePublishSession = async (sessionId: string, patientIds: string[]) => {
    await fetch(`/api/sessions/${sessionId}/publish`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ patientIds })
    });
  };

  return (
    <EnhancedSessionBuilder
      exercises={exercises}
      patients={patients}
      onSave={handleSaveSession}
      onPublish={handlePublishSession}
      existingSession={editingSession}
    />
  );
}
```

### 2. Interface Patient

#### Page des S√©ances Patient
```typescript
import { PatientSessions } from '@/components/patient-sessions';

function PatientSessionsPage() {
  const [sessions, setSessions] = useState([]);

  const handleCompleteSession = async (sessionId: string, feedback: string, effort: number, duration: number) => {
    await fetch(`/api/patient-sessions/${sessionId}/complete`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ feedback, effort, duration })
    });
    fetchSessions(); // Refresh
  };

  const handleSkipSession = async (sessionId: string) => {
    // Impl√©mentation du skip
    await fetch(`/api/patient-sessions/${sessionId}/skip`, {
      method: 'POST'
    });
    fetchSessions();
  };

  return (
    <PatientSessions
      sessions={sessions}
      onCompleteSession={handleCompleteSession}
      onSkipSession={handleSkipSession}
      onRefresh={fetchSessions}
    />
  );
}
```

### 3. Cards d'Exercices Am√©lior√©es

```typescript
import { ExerciseCard } from '@/components/exercise-card';

function ExercisesList({ exercises, isAdmin = false }) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {exercises.map(exercise => (
        <ExerciseCard
          key={exercise.id}
          exercise={exercise}
          showAdminFeatures={isAdmin}
          onStart={() => startExercise(exercise.id)}
        />
      ))}
    </div>
  );
}
```

## üîÑ Nouveaux Endpoints API

### Sessions
- `GET /api/sessions` - R√©cup√©rer s√©ances avec filtres
- `POST /api/sessions` - Cr√©er s√©ance (admin)
- `PUT /api/sessions/:id` - Modifier s√©ance (admin)
- `POST /api/sessions/:id/publish` - Publier s√©ance (admin)

### Assignations Patient
- `GET /api/patient-sessions` - S√©ances du patient connect√©
- `POST /api/patient-sessions/:id/complete` - Marquer comme termin√©e

### Administration
- `GET /api/admin/dashboard` - Statistiques dashboard
- `GET /api/admin/patients` - Patients avec leurs s√©ances
- `PUT /api/exercises/:id` - Modifier exercice (admin)

## üìä Structure de Donn√©es

### PatientSession
```typescript
interface PatientSession {
  id: string;
  patientId: string;
  sessionId: string;
  status: 'assigned' | 'done' | 'skipped';
  feedback?: string;
  effort?: number; // 1-10
  duration?: number; // minutes
  assignedAt: string;
  completedAt?: string;
}
```

### Exercise (√©tendu)
```typescript
interface ExtendedExercise {
  // ... champs existants
  tags: string[];
  variable1?: string;
  variable2?: string;
  variable3?: string;
  mediaUrl?: string;
}
```

### CustomSession (√©tendu)
```typescript
interface CustomSession {
  // ... champs existants
  status: 'draft' | 'published' | 'archived';
}
```

## üé® Styles et Th√®mes

Les composants utilisent le syst√®me de design existant avec Tailwind CSS et Shadcn/UI. Assurez-vous que votre configuration inclut :

```css
/* Couleurs personnalis√©es pour les statuts */
.status-assigned { @apply bg-blue-100 text-blue-800 border-blue-200; }
.status-done { @apply bg-green-100 text-green-800 border-green-200; }
.status-skipped { @apply bg-red-100 text-red-800 border-red-200; }

/* Variables dynamiques */
.variable-display { @apply p-2 bg-blue-50 rounded-lg border border-blue-200; }
```

## üß™ Tests et Validation

### Tests API (avec curl)

```bash
# Cr√©er une s√©ance
curl -X POST http://localhost:3000/api/sessions \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Session","description":"Description test","category":"relaxation"}'

# Publier une s√©ance
curl -X POST http://localhost:3000/api/sessions/{sessionId}/publish \
  -H "Content-Type: application/json" \
  -d '{"patientIds":["patient1","patient2"]}'

# Compl√©ter une s√©ance
curl -X POST http://localhost:3000/api/patient-sessions/{sessionId}/complete \
  -H "Content-Type: application/json" \
  -d '{"feedback":"Tr√®s bien!","effort":7,"duration":25}'
```

### Validation Frontend

1. **Interface Admin** : V√©rifiez que seuls les administrateurs peuvent acc√©der aux fonctions de gestion
2. **Interface Patient** : Testez le syst√®me de feedback et la navigation entre statuts
3. **Filtres** : Validez que tous les filtres (tags, cat√©gories, statuts) fonctionnent
4. **Responsive** : Assurez-vous que l'interface est adapt√©e mobile

## üîí S√©curit√© et Permissions

- ‚úÖ **Authentification** : Tous les endpoints n√©cessitent une authentification
- ‚úÖ **Autorisation** : S√©paration claire admin/patient
- ‚úÖ **Validation** : Validation c√¥t√© serveur de toutes les donn√©es
- ‚úÖ **Sanitisation** : Nettoyage des inputs utilisateur

## üìà M√©triques et Monitoring

Les nouveaux endpoints g√©n√®rent des m√©triques utiles :
- Taux de compl√©tion des s√©ances
- Effort moyen par patient
- S√©ances les plus populaires
- Feedback qualitatif des patients

## üêõ D√©pannage Courant

### 1. Erreur de migration
```bash
# V√©rifier que la base de donn√©es est accessible
psql -d $DATABASE_URL -c "SELECT version();"
```

### 2. Types TypeScript manquants
```bash
# R√©g√©n√©rer les types
npm run build
```

### 3. Composants UI manquants
```bash
# Installer les d√©pendances manquantes
npm install @radix-ui/react-dialog @radix-ui/react-tooltip @radix-ui/react-slider
```

## üìû Support

Pour toute question ou probl√®me :
1. V√©rifiez ce guide d'int√©gration
2. Consultez les logs serveur pour les erreurs API
3. Validez que la migration DB s'est bien pass√©e
4. Testez les endpoints avec curl avant d'int√©grer au frontend

---

**üéâ F√©licitations !** Vous avez maintenant un syst√®me complet de gestion de s√©ances avec assignation patient, feedback d√©taill√©, et interface administrateur avanc√©e.